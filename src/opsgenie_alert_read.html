<script type="text/javascript">
    RED.nodes.registerType('OpsgenieAlertRead', {
        category: 'Opsgenie',
        color: '#2684ff',
        defaults: {
            parameters: { type: "opsgenie-config", required: true },
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        paletteLabel: "Opsgenie Alert Read",
        icon: "alert.png",

        label: function () {
            return this.name || "Opsgenie Alert Read";
        }
    });
</script>


<script type="text/x-red" data-template-name="OpsgenieAlertRead">
    <div class="form-row">
        <label for="node-input-parameters"><i class="fa fa-plug"></i> Parameters</label>
        <input type="text" id="node-input-parameters">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>

        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/x-red" data-help-name="OpsgenieAlertRead">        
    <p>This node will pull the existing alerts from your Opsgenie setup according the configuration.</p>
    <h3>Inputs</h3>
        <dl class="message-properties">
            <dt>action
                <span class="property-type">string</span>
            </dt>
            <dd>the read action.</dd>
        </dl>
    
    <h3>Details</h3>
        <p>
            <code>msg.action</code> is used to indicate to the node what alert action that should be executed. It consists of a string of the following possible values:
        </p>
        <ul>
            <li>'list': When triggered, this action will retrieve a list of the alerts from the <a href="https://docs.opsgenie.com/docs/alert-api#list-alerts">Alerts API Endpoint</a> producing one message per alert.</li>
        </ul>

        <p>
            <h4>In order to trigger a new pulling action, of the parameter "action" is required:</h4>
        </p>
        <pre>"action": "list"</pre>
        <p>The Response will contain something similar to</p>
        <pre>"msg": {
            "event_type": "Opsgenie Alert",
            "topic": "Opsgenie Alert",
            "payload": element.message,
            "data": 
            {
              "id": "70413a06-38d6-4c85-92b8-5ebc900d42e2",
              "tinyId": "1791",
              "alias": "event_573",
              "message": "Our servers are in danger",
              "status": "closed",
              "acknowledged": false,
              "isSeen": true,
              "tags": [ "OverwriteQuietHours", "Critical" ],
              "snoozed": true,
              "snoozedUntil": "2017-04-03T20:32:35.143Z",
              "count": 79,
              "lastOccurredAt": "2017-04-03T20:05:50.894Z",
              "createdAt": "2017-03-21T20:32:52.353Z",
              "updatedAt": "2017-04-03T20:32:57.301Z",
              "source": "Isengard",
              "owner": "morpheus@opsgenie.com",
              "priority": "P4",
              "responders":[ 
                { "id":"4513b7ea-3b91-438f-b7e4-e3e54af9147c", "type":"team" },
                { "id":"bb4d9938-c3c2-455d-aaab-727aa701c0d8", "type":"user" },
                { "id":"aee8a0de-c80f-4515-a232-501c0bc9d715", "type":"escalation" }, 
                { "id":"80564037-1984-4f38-b98e-8a1f662df552", "type":"schedule" }
              ],
              "integration": { 
                  "id": "4513b7ea-3b91-438f-b7e4-e3e54af9147c",
                  "name": "Nebuchadnezzar",
                  "type": "API"
              },
              "report": {
                  "ackTime": 15702,
                  "closeTime": 60503,
                  "acknowledgedBy": "agent_smith@opsgenie.com",
                  "closedBy": "neo@opsgenie.com"
              }
            },
            {
              "id": "70413a06-38d6-4c85-92b8-5ebc900d42e2",
              "tinyId": "1791",
              "alias": "event_573",
              "message": "Sample Message",
              "status": "open",
              "acknowledged": false,
              "isSeen": false,
              "tags": [ "RandomTag" ],
              "snoozed": false,
              "count": 1,
              "lastOccurredAt": "2017-03-21T20:32:52.353Z",
              "createdAt": "2017-03-21T20:32:52.353Z",
              "updatedAt": "2017-04-03T20:32:57.301Z",
              "source": "Zion",
              "owner": "",
              "priority": "P5",
              "responders":[],
              "integration": {
                  "id": "4513b7ea-3b91-b7e4-438f-e3e54af9147c",
                  "name": "My_Lovely_Amazon",
                  "type": "CloudWatch"
              }
            }}
        </pre>
</script>
